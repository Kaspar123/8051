#include <cassert>
#include <cstdio>
#include <cstring>
#include <libusb-1.0/libusb.h>

#define VENDOR_ID    0x10c4
#define PRODUCT_ID   0xea60

int main()
{
  libusb_context       *context    = NULL;
  libusb_device_handle *dev_handle = NULL;
  int rc = 0;

  rc = libusb_init(&context);
  libusb_set_debug(NULL, LIBUSB_LOG_LEVEL_INFO);
  dev_handle = libusb_open_device_with_vid_pid(context,VENDOR_ID,PRODUCT_ID);
  assert(dev_handle != NULL);

  unsigned char in_buffer[200] = {0};
  int actual = 0;

  /*Check if kenel driver attached*/
  if(libusb_kernel_driver_active(dev_handle, 0))
  {
    rc = libusb_detach_kernel_driver(dev_handle, 0); // detach driver
  }
  rc = libusb_claim_interface(dev_handle, 0);

  libusb_control_transfer(dev_handle, 0x41, 0x00, 0xffff, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x01, 1000);
libusb_control_transfer(dev_handle, 0xc0, 0x10, 0x0000, 0x0000, in_buffer, 0x14, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0700, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0800, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0800, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0800, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0800, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0101, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0202, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x0005, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x0005, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x000a, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0700, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x05, 0x0000, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x00, 0x0000, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x00, 0xffff, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x01, 1000);
libusb_control_transfer(dev_handle, 0xc0, 0x10, 0x0000, 0x0000, in_buffer, 0x14, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0700, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0800, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0800, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0800, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0800, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0101, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0202, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x000a, 0x0000, in_buffer, 0x00, 1000);
unsigned char out_buffer_0[8] = {0x2f, 0x30, 0x30, 0x49, 0x44, 0x45, 0x44, 0x0d};
libusb_bulk_transfer(dev_handle, 1, out_buffer_0, 8, &actual, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x000a, 0x0000, in_buffer, 0x00, 1000);
unsigned char out_buffer_1[8] = {0x2f, 0x30, 0x30, 0x49, 0x44, 0x45, 0x44, 0x0d};
libusb_bulk_transfer(dev_handle, 1, out_buffer_1, 8, &actual, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x000a, 0x0000, in_buffer, 0x00, 1000);
unsigned char out_buffer_2[9] = {0x2f, 0x30, 0x30, 0x43, 0x43, 0x45, 0x32, 0x42, 0x0d};
libusb_bulk_transfer(dev_handle, 1, out_buffer_2, 9, &actual, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x0005, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x0005, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x12, 0x000a, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x1e, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0200, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x07, 0x0100, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0xc1, 0x08, 0x0000, 0x0000, in_buffer, 0x04, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x03, 0x0700, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x19, 0x0000, 0x0000, in_buffer, 0x06, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x13, 0x0000, 0x0000, in_buffer, 0x10, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x05, 0x0000, 0x0000, in_buffer, 0x00, 1000);
libusb_control_transfer(dev_handle, 0x41, 0x00, 0x0000, 0x0000, in_buffer, 0x00, 1000);



   rc = libusb_release_interface(dev_handle, 0);

   printf("Wrote data to usb device\n");

   libusb_close(dev_handle);
   libusb_exit(context);

   return 0;
}
